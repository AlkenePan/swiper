<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-05-03 Sun 15:47 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ivy User Manual</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Oleh Krehel" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/styles/readtheorg/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="css/kbd-style.css"/>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Ivy User Manual</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#copying">1. Copying</a></li>
<li><a href="#introduction">2. Introduction</a></li>
<li><a href="#installation">3. Installation</a>
<ul>
<li><a href="#installing-from-emacs-package-manager">3.1. Installing from Emacs Package Manager</a></li>
<li><a href="#installing-from-the-git-repository">3.2. Installing from the Git repository</a></li>
</ul>
</li>
<li><a href="#getting-started">4. Getting started</a>
<ul>
<li><a href="#basic-customization">4.1. Basic customization</a></li>
</ul>
</li>
<li><a href="#key-bindings">5. Key bindings</a>
<ul>
<li><a href="#global-key-bindings">5.1. Global key bindings</a></li>
<li><a href="#minibuffer-key-bindings">5.2. Minibuffer key bindings</a>
<ul>
<li><a href="#key-bindings-for-navigation">5.2.1. Key bindings for navigation</a></li>
<li><a href="#key-bindings-for-single-selection-action-then-exit-minibuffer">5.2.2. Key bindings for single selection, action, then exit minibuffer</a></li>
<li><a href="#key-bindings-for-multiple-selections-and-actions-keep-minibuffer-open">5.2.3. Key bindings for multiple selections and actions, keep minibuffer open</a></li>
<li><a href="#key-bindings-that-alter-the-minibuffer-input">5.2.4. Key bindings that alter the minibuffer input</a></li>
<li><a href="#other-key-bindings">5.2.5. Other key bindings</a></li>
<li><a href="#hydra-in-the-minibuffer">5.2.6. Hydra in the minibuffer</a></li>
<li><a href="#saving-the-current-completion-session-to-a-buffer">5.2.7. Saving the current completion session to a buffer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#completion-styles">6. Completion Styles</a>
<ul>
<li><a href="#ivy--regex-plus">6.1. ivy&#x2013;regex-plus</a></li>
<li><a href="#ivy--regex-ignore-order">6.2. ivy&#x2013;regex-ignore-order</a></li>
<li><a href="#ivy--regex-fuzzy">6.3. ivy&#x2013;regex-fuzzy</a></li>
</ul>
</li>
<li><a href="#customization">7. Customization</a>
<ul>
<li><a href="#faces">7.1. Faces</a></li>
<li><a href="#defcustoms">7.2. Defcustoms</a></li>
<li><a href="#actions">7.3. Actions</a>
<ul>
<li><a href="#what-are-actions">7.3.1. What are actions?</a></li>
<li><a href="#how-can-different-actions-be-called">7.3.2. How can different actions be called?</a></li>
<li><a href="#how-to-modify-the-actions-list">7.3.3. How to modify the actions list?</a></li>
<li><a href="#example---add-two-actions-to-each-command">7.3.4. Example - add two actions to each command</a>
<ul>
<li><a href="#how-to-undo-adding-the-two-actions">7.3.4.1. How to undo adding the two actions</a></li>
<li><a href="#how-to-add-actions-to-a-specific-command">7.3.4.2. How to add actions to a specific command</a></li>
</ul>
</li>
<li><a href="#example---define-a-new-command-with-several-actions">7.3.5. Example - define a new command with several actions</a>
<ul>
<li><a href="#test-the-above-function-with-ivy-occur">7.3.5.1. Test the above function with <code>ivy-occur</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#packages">7.4. Packages</a></li>
</ul>
</li>
<li><a href="#commands">8. Commands</a>
<ul>
<li><a href="#file-name-completion">8.1. File Name Completion</a>
<ul>
<li><a href="#using-tramp">8.1.1. Using TRAMP</a></li>
</ul>
</li>
<li><a href="#buffer-name-completion">8.2. Buffer Name Completion</a></li>
<li><a href="#counsel-commands">8.3. Counsel commands</a></li>
</ul>
</li>
<li><a href="#api">9. API</a>
<ul>
<li><a href="#required-arguments-for-ivy-read">9.1. Required arguments for <code>ivy-read</code></a></li>
<li><a href="#optional-arguments-for-ivy-read">9.2. Optional arguments for <code>ivy-read</code></a></li>
<li><a href="#example---counsel-describe-function">9.3. Example - <code>counsel-describe-function</code></a></li>
<li><a href="#example---counsel-locate">9.4. Example - <code>counsel-locate</code></a></li>
<li><a href="#example---ivy-read-with-extra-properties">9.5. Example - <code>ivy-read-with-extra-properties</code></a></li>
</ul>
</li>
<li><a href="#variable-index">10. Variable Index</a></li>
<li><a href="#key-index">11. Keystroke Index</a></li>
</ul>
</div>
</div>
<div id="outline-container-copying" class="outline-2">
<h2 id="copying"><span class="section-number-2">1</span> Copying</h2>
<div class="outline-text-2" id="text-copying">
<p>
Ivy manual, version 0.13.0
</p>

<p>
Ivy is an interactive interface for completion in Emacs. Emacs uses
completion mechanism in a variety of contexts: code, menus, commands,
variables, functions, etc. Completion entails listing, sorting,
filtering, previewing, and applying actions on selected items. When
active, <code>ivy-mode</code> completes the selection process by narrowing
available choices while previewing in the minibuffer. Selecting the
final candidate is either through simple keyboard character inputs or
through powerful regular expressions.
</p>
<p>
Copyright (C) 2015-2019 Free Software Foundation, Inc.
</p>

<blockquote>
<p>
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled "GNU
Free Documentation License".
</p>
</blockquote>

<a href="https://github.com/abo-abo/swiper/blob/master/doc/ivy.org">This manual source</a>
</div>
</div>
<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction"><span class="section-number-2">2</span> Introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
Ivy is for quick and easy selection from a list. When Emacs prompts
for a string from a list of several possible choices, Ivy springs into
action to assist in narrowing and picking the right string from a vast
number of choices.
</p>

<p>
Ivy strives for minimalism, simplicity, customizability and
discoverability.
</p>

<dl class="org-dl">
<dt>Minimalism</dt><dd>Uncluttered minibuffer is minimalism. Ivy shows the completion
defaults, the number of matches, and 10 candidate matches below
the input line. Customize <code>ivy-height</code> to adjust the number of
candidate matches displayed in the minibuffer.</dd>

<dt>Simplicity</dt><dd>Simplicity is about Ivy's behavior in the minibuffer. It is also
about the code interface to extend Ivy's functionality. The
minibuffer area behaves as close to <code>fundamental-mode</code> as
possible. <kbd>SPC</kbd> inserts a space, for example, instead of being
bound to the more complex <code>minibuffer-complete-word</code>. Ivy's code
uses easy-to-examine global variables; avoids needless
complications with branch-introducing custom macros.</dd>

<dt>Customizability</dt><dd>Customizability is about being able to use different methods and
interfaces of completion to tailor the selection process. For
example, adding a custom display function that points to a
selected candidate with <code>&gt;</code>, instead of highlighting the selected
candidate with the <code>ivy-current-match</code> face (see
<code>ivy-format-functions-alist</code>). Or take the customization of actions, say
after the candidate function is selected. <kbd>RET</kbd> uses
<code>counsel-describe-function</code> to describe the function, whereas
<kbd>M-o d</kbd> jumps to that function's definition in the code. The
<kbd>M-o</kbd> prefix can be uniformly used with characters like <kbd>d</kbd> to
group similar actions.</dd>

<dt>Discoverability</dt><dd>Ivy displays easily discoverable commands through the hydra
facility.  <kbd>C-o</kbd> in the minibuffer displays a hydra menu. It
opens up within an expanded minibuffer area. Each menu item comes
with short documentation strings and highlighted one-key
completions. So discovering even seldom used keys is simply a
matter of <kbd>C-o</kbd> in the minibuffer while in the midst of the Ivy
interaction. This discoverability minimizes exiting Ivy interface
for documentation look-ups.</dd>
</dl>
</div>
</div>

<div id="outline-container-installation" class="outline-2">
<h2 id="installation"><span class="section-number-2">3</span> Installation</h2>
<div class="outline-text-2" id="text-installation">
<p>
Install Ivy automatically through Emacs's package manager, or manually
from Ivy's development repository.
</p>

<p>
Emacs 24.3 is the oldest version to run Ivy. Emacs 24.4 is the oldest
version that runs Ivy with fancy faces display.
</p>
</div>

<div id="outline-container-installing-from-emacs-package-manager" class="outline-3">
<h3 id="installing-from-emacs-package-manager"><span class="section-number-3">3.1</span> Installing from Emacs Package Manager</h3>
<div class="outline-text-3" id="text-installing-from-emacs-package-manager">
<p>
<kbd>M-x</kbd> <code>package-install</code> <kbd>RET</kbd> <code>ivy</code> <kbd>RET</kbd>
</p>

<p>
Ivy is installed as part of <code>ivy</code> package, which is available from two
different package archives, GNU ELPA and MELPA. For the latest stable
version, use the GNU ELPA archives using the above M-x command.
</p>

<p>
For current hourly builds, use the MELPA archives. In MELPA, Ivy is
split into three packages: <code>ivy</code>, <code>swiper</code> and <code>counsel</code>; you can simply
install <code>counsel</code> which will bring in the other two as dependencies.
See the code below for adding MELPA to the list of package archives:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">require</span> '<span style="color: #110099;">package</span>)
(add-to-list 'package-archives
             '(<span style="color: #2A00FF;">"melpa"</span> . <span style="color: #2A00FF;">"https://melpa.org/packages/"</span>))
</pre>
</div>

<p>
After this do <kbd>M-x</kbd> <code>package-refresh-contents</code> <kbd>RET</kbd>, followed by <kbd>M-x</kbd>
<code>package-install</code> <kbd>RET</kbd> <code>counsel</code> <kbd>RET</kbd>.
</p>

<p>
For package manager details, see <a href="https://www.gnu.org/software/emacs/manual/html_mono/emacs.html#Packages">emacs#Packages</a>.
</p>
</div>
</div>

<div id="outline-container-installing-from-the-git-repository" class="outline-3">
<h3 id="installing-from-the-git-repository"><span class="section-number-3">3.2</span> Installing from the Git repository</h3>
<div class="outline-text-3" id="text-installing-from-the-git-repository">
<dl class="org-dl">
<dt>Why install from Git?</dt><dd><ul class="org-ul">
<li>No need to wait for MELPA's hourly builds</li>
<li>Easy to revert to previous versions</li>
<li>Contribute to Ivy's development; send patches; pull requests</li>
</ul></dd>
</dl>


<dl class="org-dl">
<dt>Configuration steps</dt><dd><p>
First clone the Swiper repository with:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #7F0055; font-weight: bold;">cd</span> ~/git &amp;&amp; git clone https://github.com/abo-abo/swiper
<span style="color: #7F0055; font-weight: bold;">cd</span> swiper &amp;&amp; make compile
</pre>
</div>

<p>
Second, add these lines to the Emacs init file:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(add-to-list 'load-path <span style="color: #2A00FF;">"~/git/swiper/"</span>)
(<span style="color: #7F0055; font-weight: bold;">require</span> '<span style="color: #110099;">ivy</span>)
</pre>
</div>

<p>
Then, update the code with:
</p>

<div class="org-src-container">
<pre class="src src-sh">git pull
make
</pre>
</div></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-getting-started" class="outline-2">
<h2 id="getting-started"><span class="section-number-2">4</span> Getting started</h2>
<div class="outline-text-2" id="text-getting-started">
<p>
First enable Ivy completion everywhere:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(ivy-mode 1)
</pre>
</div>

<p>
Note: <code>ivy-mode</code> can be toggled on and off with <kbd>M-x</kbd> <code>ivy-mode</code>.
</p>
</div>
<div id="outline-container-basic-customization" class="outline-3">
<h3 id="basic-customization"><span class="section-number-3">4.1</span> Basic customization</h3>
<div class="outline-text-3" id="text-basic-customization">
<p>
Here are some basic settings particularly useful for new Ivy users:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-use-virtual-buffers t)
(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-count-format <span style="color: #2A00FF;">"(%d/%d) "</span>)
</pre>
</div>

<p>
If you want, you can go without any customizations at all. The above
settings are the most bang for the buck in terms of customization.  So
users that typically don't like customize a lot are advised to look at
these settings first.
</p>

<p>
For more advanced customizations, refer to <code>M-x describe-variable</code>
documentation.
</p>
</div>
</div>
</div>

<div id="outline-container-key-bindings" class="outline-2">
<h2 id="key-bindings"><span class="section-number-2">5</span> Key bindings</h2>
<div class="outline-text-2" id="text-key-bindings">
</div>
<div id="outline-container-global-key-bindings" class="outline-3">
<h3 id="global-key-bindings"><span class="section-number-3">5.1</span> Global key bindings</h3>
<div class="outline-text-3" id="text-global-key-bindings">
<p>
Here is a list of commands that are useful to be bound globally, along
with some sample bindings:
</p>

<dl class="org-dl">
<dt>Ivy-based interface to standard commands</dt><dd><div class="org-src-container">
<pre class="src src-elisp">(global-set-key (kbd <span style="color: #2A00FF;">"C-s"</span>) 'swiper-isearch)
(global-set-key (kbd <span style="color: #2A00FF;">"M-x"</span>) 'counsel-M-x)
(global-set-key (kbd <span style="color: #2A00FF;">"C-x C-f"</span>) 'counsel-find-file)
(global-set-key (kbd <span style="color: #2A00FF;">"M-y"</span>) 'counsel-yank-pop)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f1&gt; f"</span>) 'counsel-describe-function)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f1&gt; v"</span>) 'counsel-describe-variable)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f1&gt; l"</span>) 'counsel-find-library)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f2&gt; i"</span>) 'counsel-info-lookup-symbol)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f2&gt; u"</span>) 'counsel-unicode-char)
(global-set-key (kbd <span style="color: #2A00FF;">"&lt;f2&gt; j"</span>) 'counsel-set-variable)
(global-set-key (kbd <span style="color: #2A00FF;">"C-x b"</span>) 'ivy-switch-buffer)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c v"</span>) 'ivy-push-view)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c V"</span>) 'ivy-pop-view)
</pre>
</div></dd>

<dt>Ivy-based interface to shell and system tools</dt><dd><div class="org-src-container">
<pre class="src src-elisp">(global-set-key (kbd <span style="color: #2A00FF;">"C-c c"</span>) 'counsel-compile)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c g"</span>) 'counsel-git)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c j"</span>) 'counsel-git-grep)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c L"</span>) 'counsel-git-log)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c k"</span>) 'counsel-rg)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c m"</span>) 'counsel-linux-app)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c n"</span>) 'counsel-fzf)
(global-set-key (kbd <span style="color: #2A00FF;">"C-x l"</span>) 'counsel-locate)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c J"</span>) 'counsel-file-jump)
(global-set-key (kbd <span style="color: #2A00FF;">"C-S-o"</span>) 'counsel-rhythmbox)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c w"</span>) 'counsel-wmctrl)
</pre>
</div></dd>

<dt>Ivy-resume and other commands</dt><dd><p>
<code>ivy-resume</code> resumes the last Ivy-based completion.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(global-set-key (kbd <span style="color: #2A00FF;">"C-c C-r"</span>) 'ivy-resume)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c b"</span>) 'counsel-bookmark)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c d"</span>) 'counsel-descbinds)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c g"</span>) 'counsel-git)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c o"</span>) 'counsel-outline)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c t"</span>) 'counsel-load-theme)
(global-set-key (kbd <span style="color: #2A00FF;">"C-c F"</span>) 'counsel-org-file)
</pre>
</div></dd>
</dl>

<p>
You can also enable <code>counsel-mode</code> to make some global key binding remapping for you.
</p>
</div>
</div>

<div id="outline-container-minibuffer-key-bindings" class="outline-3">
<h3 id="minibuffer-key-bindings"><span class="section-number-3">5.2</span> Minibuffer key bindings</h3>
<div class="outline-text-3" id="text-minibuffer-key-bindings">
<p>
Ivy includes several minibuffer bindings, which are defined in the
<code>ivy-minibuffer-map</code> keymap variable. The most frequently used ones
are described here.
</p>

<p>
<code>swiper</code> or <code>counsel-M-x</code> add more key bindings through the <code>keymap</code>
argument to <code>ivy-read</code>. These keys, also active in the minibuffer, are
described under their respective commands.
</p>

<p>
A key feature of <code>ivy-minibuffer-map</code> is its full editing capability
where the familiar <kbd>C-a</kbd>, <kbd>C-f</kbd>, <kbd>M-d</kbd>, <kbd>M-DEL</kbd>, <kbd>M-b</kbd>, <kbd>M-w</kbd>, <kbd>C-k</kbd>,
<kbd>C-y</kbd> key bindings work the same as in <code>fundamental-mode</code>.
</p>
</div>

<div id="outline-container-key-bindings-for-navigation" class="outline-4">
<h4 id="key-bindings-for-navigation"><span class="section-number-4">5.2.1</span> Key bindings for navigation</h4>
<div class="outline-text-4" id="text-key-bindings-for-navigation">
<ul class="org-ul">
<li><kbd>C-n</kbd> (<code>ivy-next-line</code>) selects the next candidate</li>
<li><kbd>C-p</kbd> (<code>ivy-previous-line</code>) selects the previous candidate</li>
<li><kbd>M-&lt;</kbd> (<code>ivy-beginning-of-buffer</code>) selects the first candidate</li>
<li><kbd>M-&gt;</kbd> (<code>ivy-end-of-buffer</code>) selects the last candidate</li>
<li><kbd>C-v</kbd> (<code>ivy-scroll-up-command</code>) scrolls up by <code>ivy-height</code> lines</li>
<li><kbd>M-v</kbd> (<code>ivy-scroll-down-command</code>) scrolls down by <code>ivy-height</code> lines</li>
</ul>


<dl class="org-dl">
<dt>User Option <code>ivy-wrap</code></dt><dd><p>
Specifies the wrap-around behavior for <kbd>C-n</kbd> and <kbd>C-p</kbd>. When
<code>ivy-wrap</code> is set to <code>t</code>, <code>ivy-next-line</code> and <code>ivy-previous-line</code>
will cycle past the last and the first candidates respectively.
</p>

<p>
Wrap-around behavior is off by default.
</p></dd>

<dt>User Option <code>ivy-height</code></dt><dd><p>
Use this option to adjust the minibuffer height, which also
affects scroll size when using <kbd>C-v</kbd> and <kbd>M-v</kbd> key bindings.
</p>

<p>
<code>ivy-height</code> is 10 lines by default.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-key-bindings-for-single-selection-action-then-exit-minibuffer" class="outline-4">
<h4 id="key-bindings-for-single-selection-action-then-exit-minibuffer"><span class="section-number-4">5.2.2</span> Key bindings for single selection, action, then exit minibuffer</h4>
<div class="outline-text-4" id="text-key-bindings-for-single-selection-action-then-exit-minibuffer">
<p>
Ivy can offer several actions from which to choose which action to
run. This "calling an action" operates on the selected candidate. For
example, when viewing a list of files, one action could open it for
editing, one to view it, another to invoke a special function, and so
on. Custom actions can be added to this interface. The precise action
to call on the selected candidate can be delayed until after the
narrowing is completed. No need to exit the interface if unsure which
action to run. This delayed flexibility and customization of actions
extends usability of lists in Emacs.
</p>

<dl class="org-dl">
<dt><kbd>C-m</kbd> or <kbd>RET</kbd> (<code>ivy-done</code>)</dt><dd>Calls the default action and then exits the minibuffer.</dd>

<dt><kbd>M-o</kbd> (<code>ivy-dispatching-done</code>)</dt><dd>Presents valid actions from which to choose. When only one action
is available, there is no difference between <kbd>M-o</kbd> and <kbd>C-m</kbd>.</dd>

<dt><kbd>C-j</kbd> (<code>ivy-alt-done</code>)</dt><dd>When completing file names, selects the current directory
candidate and starts a new completion session there. Otherwise,
it is the same as <code>ivy-done</code>.</dd>

<dt><kbd>TAB</kbd> (<code>ivy-partial-or-done</code>)</dt><dd><p>
Attempts partial completion, extending current input as much as
possible. <kbd>TAB TAB</kbd> is the same as <kbd>C-j</kbd> (<code>ivy-alt-done</code>).
</p>

<p>
Example ERT test:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">should</span>
 (equal (ivy-with
         '(<span style="color: #7F0055; font-weight: bold;">progn</span>
           (ivy-read <span style="color: #2A00FF;">"Test: "</span> '(<span style="color: #2A00FF;">"can do"</span> <span style="color: #2A00FF;">"can't, sorry"</span> <span style="color: #2A00FF;">"other"</span>))
           ivy-text)
         <span style="color: #2A00FF;">"c &lt;tab&gt;"</span>)
        <span style="color: #2A00FF;">"can"</span>))
</pre>
</div></dd>

<dt><kbd>C-M-j</kbd> (<code>ivy-immediate-done</code>)</dt><dd><p>
Exits with <i>the current input</i> instead of <i>the current candidate</i>
(like other commands).
</p>

<p>
This is useful e.g. when you call <code>find-file</code> to create a new
file, but the desired name matches an existing file. In that
case, using <kbd>C-j</kbd> would select that existing file, which isn't
what you want - use this command instead.
</p></dd>

<dt><kbd>C-'</kbd> (<code>ivy-avy</code>)</dt><dd>Uses avy to select one of the candidates on the current candidate
page.  This can often be faster than multiple <kbd>C-n</kbd> or <kbd>C-p</kbd>
keystrokes followed by <kbd>C-m</kbd>.</dd>
</dl>
</div>
</div>

<div id="outline-container-key-bindings-for-multiple-selections-and-actions-keep-minibuffer-open" class="outline-4">
<h4 id="key-bindings-for-multiple-selections-and-actions-keep-minibuffer-open"><span class="section-number-4">5.2.3</span> Key bindings for multiple selections and actions, keep minibuffer open</h4>
<div class="outline-text-4" id="text-key-bindings-for-multiple-selections-and-actions-keep-minibuffer-open">
<p>
For repeatedly applying multiple actions or acting on multiple
candidates, Ivy does not close the minibuffer between commands. It
keeps the minibuffer open for applying subsequent actions.
</p>

<p>
Adding an extra meta key to the normal key chord invokes the special
version of the regular commands that enables applying multiple
actions.
</p>

<dl class="org-dl">
<dt><kbd>C-M-m</kbd> (<code>ivy-call</code>)</dt><dd><p>
Is the non-exiting version of <kbd>C-m</kbd> (<code>ivy-done</code>).
</p>

<p>
Instead of closing the minibuffer, <kbd>C-M-m</kbd> allows selecting
another candidate or another action. For example, <kbd>C-M-m</kbd> on
functions list invokes <code>describe-function</code>. When combined with
<kbd>C-n</kbd>, function descriptions can be invoked quickly in
succession.
</p></dd>

<dt><kbd>C-M-o</kbd> (<code>ivy-dispatching-call</code>)</dt><dd><p>
Is the non-exiting version of <kbd>M-o</kbd> (<code>ivy-dispatching-done</code>).
</p>

<p>
For example, during the <code>counsel-rhythmbox</code> completion, press
<kbd>C-M-o e</kbd> to en-queue the selected candidate, followed by <kbd>C-n
     C-m</kbd> to play the next candidate - the current action reverts to
the default one after <kbd>C-M-o</kbd>.
</p></dd>

<dt><kbd>C-M-n</kbd> (<code>ivy-next-line-and-call</code>)</dt><dd><p>
Combines <kbd>C-n</kbd> and <kbd>C-M-m</kbd>. Moves to next line and applies an action.
</p>

<p>
Comes in handy when opening multiple files from
<code>counsel-find-file</code>, <code>counsel-git-grep</code>, <code>counsel-ag</code>, <code>counsel-rg</code>, or
<code>counsel-locate</code> lists. Just hold <kbd>C-M-n</kbd> for rapid-fire default
action on each successive element of the list.
</p></dd>

<dt><kbd>C-M-p</kbd> (<code>ivy-previous-line-and-call</code>)</dt><dd><p>
Combines <kbd>C-p</kbd> and <kbd>C-M-m</kbd>.
</p>

<p>
Similar to the above except it moves through the list in the
other direction.
</p></dd>

<dt><code>ivy-resume</code></dt><dd><p>
Recalls the state of the completion session just before its last
exit.
</p>

<p>
Useful after an accidental <kbd>C-m</kbd> (<code>ivy-done</code>).
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-key-bindings-that-alter-the-minibuffer-input" class="outline-4">
<h4 id="key-bindings-that-alter-the-minibuffer-input"><span class="section-number-4">5.2.4</span> Key bindings that alter the minibuffer input</h4>
<div class="outline-text-4" id="text-key-bindings-that-alter-the-minibuffer-input">
<dl class="org-dl">
<dt><kbd>M-n</kbd> (<code>ivy-next-history-element</code>)</dt><dd><p>
Cycles forward through the Ivy command history.
</p>

<p>
Ivy updates an internal history list after each action. When this
history list is empty, <kbd>M-n</kbd> inserts symbol (or URL) at point
into the minibuffer.
</p></dd>

<dt><kbd>M-p</kbd> (<code>ivy-previous-history-element</code>)</dt><dd>Cycles forward through the Ivy command history.</dd>

<dt><kbd>M-i</kbd> (<code>ivy-insert-current</code>)</dt><dd><p>
Inserts the current candidate into the minibuffer.
</p>

<p>
Useful for copying and renaming files, for example: <kbd>M-i</kbd> to
insert the original file name string, edit it, and then <kbd>C-m</kbd> to
complete the renaming.
</p></dd>

<dt><kbd>M-j</kbd> (<code>ivy-yank-word</code>)</dt><dd><p>
Inserts the sub-word at point into the minibuffer.
</p>

<p>
This is similar to <kbd>C-s C-w</kbd> with <code>isearch</code>.  Ivy reserves <kbd>C-w</kbd>
for <code>kill-region</code>.  See also <code>ivy-yank-symbol</code> and
<code>ivy-yank-char</code>.
</p></dd>

<dt><kbd>S-SPC</kbd> (<code>ivy-restrict-to-matches</code>)</dt><dd><p>
Deletes the current input, and resets the candidates list to the
currently restricted matches.
</p>

<p>
This is how Ivy provides narrowing in successive tiers.
</p></dd>

<dt><kbd>C-r</kbd> (<code>ivy-reverse-i-search</code>)</dt><dd><p>
Starts a recursive completion session through the command's
history.
</p>

<p>
This works just like <kbd>C-r</kbd> at the bash command prompt, where the
completion candidates are the history items. Upon completion, the
selected candidate string is inserted into the minibuffer.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-other-key-bindings" class="outline-4">
<h4 id="other-key-bindings"><span class="section-number-4">5.2.5</span> Other key bindings</h4>
<div class="outline-text-4" id="text-other-key-bindings">
<dl class="org-dl">
<dt><kbd>M-w</kbd> (<code>ivy-kill-ring-save</code>)</dt><dd><p>
Copies selected candidates to the kill ring.
</p>

<p>
Copies the region if the region is active.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-hydra-in-the-minibuffer" class="outline-4">
<h4 id="hydra-in-the-minibuffer"><span class="section-number-4">5.2.6</span> Hydra in the minibuffer</h4>
<div class="outline-text-4" id="text-hydra-in-the-minibuffer">
<dl class="org-dl">
<dt><kbd>C-o</kbd> (<code>hydra-ivy/body</code>)</dt><dd>Invokes the hydra menu with short key bindings.</dd>
</dl>

<p>
When Hydra is active, minibuffer editing is disabled and menus
display short aliases:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Short</th>
<th scope="col" class="org-left">Normal</th>
<th scope="col" class="org-left">Command name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><kbd>o</kbd></td>
<td class="org-left"><kbd>C-g</kbd></td>
<td class="org-left"><code>keyboard-escape-quit</code></td>
</tr>

<tr>
<td class="org-left"><kbd>j</kbd></td>
<td class="org-left"><kbd>C-n</kbd></td>
<td class="org-left"><code>ivy-next-line</code></td>
</tr>

<tr>
<td class="org-left"><kbd>k</kbd></td>
<td class="org-left"><kbd>C-p</kbd></td>
<td class="org-left"><code>ivy-previous-line</code></td>
</tr>

<tr>
<td class="org-left"><kbd>h</kbd></td>
<td class="org-left"><kbd>M-&lt;</kbd></td>
<td class="org-left"><code>ivy-beginning-of-buffer</code></td>
</tr>

<tr>
<td class="org-left"><kbd>l</kbd></td>
<td class="org-left"><kbd>M-&gt;</kbd></td>
<td class="org-left"><code>ivy-end-of-buffer</code></td>
</tr>

<tr>
<td class="org-left"><kbd>d</kbd></td>
<td class="org-left"><kbd>C-m</kbd></td>
<td class="org-left"><code>ivy-done</code></td>
</tr>

<tr>
<td class="org-left"><kbd>f</kbd></td>
<td class="org-left"><kbd>C-j</kbd></td>
<td class="org-left"><code>ivy-alt-done</code></td>
</tr>

<tr>
<td class="org-left"><kbd>g</kbd></td>
<td class="org-left"><kbd>C-M-m</kbd></td>
<td class="org-left"><code>ivy-call</code></td>
</tr>

<tr>
<td class="org-left"><kbd>u</kbd></td>
<td class="org-left"><kbd>C-c C-o</kbd></td>
<td class="org-left"><code>ivy-occur</code></td>
</tr>
</tbody>
</table>

<p>
Hydra reduces key strokes, for example: <kbd>C-n C-n C-n C-n</kbd> is <kbd>C-o
jjjj</kbd> in Hydra.
</p>

<p>
Hydra menu offers these additional bindings:
</p>

<dl class="org-dl">
<dt><kbd>c</kbd> (<code>ivy-toggle-calling</code>)</dt><dd>Toggle calling the action after each candidate change. It
modifies <kbd>j</kbd> to <kbd>jg</kbd>, <kbd>k</kbd> to <kbd>kg</kbd> etc.</dd>

<dt><kbd>m</kbd> (<code>ivy-rotate-preferred-builders</code>)</dt><dd>Rotate the current regexp matcher.</dd>

<dt><kbd>&gt;</kbd> (<code>ivy-minibuffer-grow</code>)</dt><dd>Increase <code>ivy-height</code> for the current minibuffer.</dd>

<dt><kbd>&lt;</kbd> (<code>ivy-minibuffer-shrink</code>)</dt><dd>Decrease <code>ivy-height</code> for the current minibuffer.</dd>

<dt><kbd>w</kbd> (<code>ivy-prev-action</code>)</dt><dd>Select the previous action.</dd>

<dt><kbd>s</kbd> (<code>ivy-next-action</code>)</dt><dd>Select the next action.</dd>

<dt><kbd>a</kbd> (<code>ivy-read-action</code>)</dt><dd>Use a menu to select an action.</dd>

<dt><kbd>C</kbd> (<code>ivy-toggle-case-fold</code>)</dt><dd>Toggle case folding (match both upper and lower case
characters for lower case input).</dd>
</dl>

<p>
Hydra menu also offers bindings for marking multiple candidates:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Key</th>
<th scope="col" class="org-left">Command name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><kbd>m</kbd></td>
<td class="org-left"><code>ivy-mark</code></td>
</tr>

<tr>
<td class="org-left"><kbd>u</kbd></td>
<td class="org-left"><code>ivy-unmark</code></td>
</tr>

<tr>
<td class="org-left"><kbd>DEL</kbd></td>
<td class="org-left"><code>ivy-unmark-backward</code></td>
</tr>

<tr>
<td class="org-left"><kbd>t</kbd></td>
<td class="org-left"><code>ivy-toggle-marks</code></td>
</tr>
</tbody>
</table>

<p>
The action is called on each marked candidate one by one.
</p>
</div>
</div>

<div id="outline-container-saving-the-current-completion-session-to-a-buffer" class="outline-4">
<h4 id="saving-the-current-completion-session-to-a-buffer"><span class="section-number-4">5.2.7</span> Saving the current completion session to a buffer</h4>
<div class="outline-text-4" id="text-saving-the-current-completion-session-to-a-buffer">
<dl class="org-dl">
<dt><kbd>C-c C-o</kbd> (<code>ivy-occur</code>)</dt><dd>Saves the current candidates to a new buffer and exits
completion.</dd>
</dl>

<p>
The new buffer is read-only and has a few useful bindings defined.
</p>

<dl class="org-dl">
<dt><kbd>RET</kbd> or <kbd>f</kbd> (<code>ivy-occur-press</code>)</dt><dd>Call the current action on the selected candidate.</dd>

<dt><kbd>mouse-1</kbd> (<code>ivy-occur-click</code>)</dt><dd>Call the current action on the selected candidate.</dd>

<dt><kbd>j</kbd> (<code>next-line</code>)</dt><dd>Move to next line.</dd>

<dt><kbd>k</kbd> (<code>previous-line</code>)</dt><dd>Move to previous line.</dd>

<dt><kbd>a</kbd> (<code>ivy-occur-read-action</code>)</dt><dd>Read an action and make it current for this buffer.</dd>

<dt><kbd>o</kbd> (<code>ivy-occur-dispatch</code>)</dt><dd>Read an action and call it on the selected candidate.</dd>

<dt><kbd>q</kbd> (<code>quit-window</code>)</dt><dd>Bury the current buffer.</dd>
</dl>


<p>
Ivy has no limit on the number of active buffers like these.
</p>

<p>
Ivy takes care of naming buffers uniquely by constructing descriptive
names. For example: <code>*ivy-occur counsel-describe-variable
"function$*</code>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-completion-styles" class="outline-2">
<h2 id="completion-styles"><span class="section-number-2">6</span> Completion Styles</h2>
<div class="outline-text-2" id="text-completion-styles">
<p>
Ivy's completion functions rely on a regex builder - a function that
transforms a string input to a string regex. All current candidates
simply have to match this regex. Each collection can be assigned its
own regex builder by customizing <code>ivy-re-builders-alist</code>.
</p>

<p>
The keys of this alist are collection names, and the values are one of
the following:
</p>
<ul class="org-ul">
<li><code>ivy--regex</code></li>
<li><code>ivy--regex-plus</code></li>
<li><code>ivy--regex-ignore-order</code></li>
<li><code>ivy--regex-fuzzy</code></li>
<li><code>regexp-quote</code></li>
</ul>

<p>
A catch-all key, <code>t</code>, applies to all collections that don't have their
own key.
</p>

<p>
The default is:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-re-builders-alist
      '((t . ivy--regex-plus)))
</pre>
</div>

<p>
This example shows a custom regex builder assigned to file name
completion:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-re-builders-alist
      '((read-file-name-internal . ivy--regex-fuzzy)
        (t . ivy--regex-plus)))
</pre>
</div>

<p>
Here, <code>read-file-name-internal</code> is a function that is passed as the
second argument to <code>completing-read</code> for file name completion.
</p>

<p>
The regex builder resolves as follows (in order of priority):
</p>
<ol class="org-ol">
<li><code>re-builder</code> argument passed to <code>ivy-read</code>.</li>
<li><code>collection</code> argument passed to <code>ivy-read</code> is a function and has an
entry on <code>ivy-re-builders-alist</code>.</li>
<li><code>caller</code> argument passed to <code>ivy-read</code> has an entry on
<code>ivy-re-builders-alist</code>.</li>
<li><code>this-command</code> has an entry on <code>ivy-re-builders-alist</code>.</li>
<li><code>t</code> has an entry on <code>ivy-re-builders-alist</code>.</li>
<li><code>ivy--regex</code>.</li>
</ol>
</div>

<div id="outline-container-ivy--regex-plus" class="outline-3">
<h3 id="ivy--regex-plus"><span class="section-number-3">6.1</span> ivy&#x2013;regex-plus</h3>
<div class="outline-text-3" id="text-ivy--regex-plus">
<p>
<code>ivy--regex-plus</code> is Ivy's default completion method.
</p>

<p>
<code>ivy--regex-plus</code> matches by splitting the input by spaces and
rebuilding it into a regex.
</p>

<p>
As the search string is typed in Ivy's minibuffer, it is transformed
into valid regex syntax. If the string is <code>"for example"</code>, it is
transformed into
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #2A00FF;">"</span><span style="color: #7F0055;">\\</span><span style="color: #7F0055;">(</span><span style="color: #2A00FF;">for</span><span style="color: #7F0055;">\\</span><span style="color: #7F0055;">)</span><span style="color: #2A00FF;">.*</span><span style="color: #7F0055;">\\</span><span style="color: #7F0055;">(</span><span style="color: #2A00FF;">example</span><span style="color: #7F0055;">\\</span><span style="color: #7F0055;">)</span><span style="color: #2A00FF;">"</span>
</pre>
</div>

<p>
which in regex terminology matches <code>"for"</code> followed by a wild card and
then <code>"example"</code>. Note how Ivy uses the space character to build wild
cards. To match a literal white space, use an extra space. So to match
one space type two spaces, to match two spaces type three spaces, and
so on.
</p>

<p>
As Ivy transforms typed characters into regex strings, it provides an
intuitive feedback through font highlights.
</p>

<p>
Ivy supports regexp negation with <code>"!"</code>.
For example, <code>"define key ! ivy quit"</code> first selects everything
matching <code>"define.*key"</code>, then removes everything matching <code>"ivy"</code>,
and finally removes everything matching <code>"quit"</code>. What remains is the
final result set of the negation regexp.
</p>

<p>
Since Ivy treats minibuffer input as a regexp, the standard regexp
identifiers work: <code>"^"</code>, <code>"$"</code>, <code>"\b"</code> or <code>"[a-z]"</code>. The exceptions
are spaces, which translate to <code>".*"</code>, and <code>"!"</code> that signal the
beginning of a negation group.
</p>
</div>
</div>

<div id="outline-container-ivy--regex-ignore-order" class="outline-3">
<h3 id="ivy--regex-ignore-order"><span class="section-number-3">6.2</span> ivy&#x2013;regex-ignore-order</h3>
<div class="outline-text-3" id="text-ivy--regex-ignore-order">
<p>
<code>ivy--regex-ignore-order</code> ignores the order of regexp tokens when
searching for matching candidates. For instance, the input
<code>"for example"</code> will match <code>"example test for"</code>.
</p>
</div>
</div>

<div id="outline-container-ivy--regex-fuzzy" class="outline-3">
<h3 id="ivy--regex-fuzzy"><span class="section-number-3">6.3</span> ivy&#x2013;regex-fuzzy</h3>
<div class="outline-text-3" id="text-ivy--regex-fuzzy">
<p>
<code>ivy--regex-fuzzy</code> splits each character with a wild card. Searching
for <code>"for"</code> returns all <code>"f.*o.*r"</code> matches, resulting in a large
number of hits.  Yet some searches need these extra hits. Ivy sorts
such large lists using <code>flx</code> package's scoring mechanism, if it's
installed.
</p>

<p>
<kbd>C-o m</kbd> toggles the current regexp builder.
</p>
</div>
</div>
</div>

<div id="outline-container-customization" class="outline-2">
<h2 id="customization"><span class="section-number-2">7</span> Customization</h2>
<div class="outline-text-2" id="text-customization">
</div>
<div id="outline-container-faces" class="outline-3">
<h3 id="faces"><span class="section-number-3">7.1</span> Faces</h3>
<div class="outline-text-3" id="text-faces">
<dl class="org-dl">
<dt><code>ivy-current-match</code></dt><dd>Highlights the currently selected candidate.</dd>
<dt><code>ivy-minibuffer-match-face-1</code></dt><dd>Highlights the background of the match.</dd>
<dt><code>ivy-minibuffer-match-face-2</code></dt><dd>Highlights the first (modulo 3) matched group.</dd>
<dt><code>ivy-minibuffer-match-face-3</code></dt><dd>Highlights the second (modulo 3) matched group.</dd>
<dt><code>ivy-minibuffer-match-face-4</code></dt><dd>Highlights the third (modulo 3) matched group.</dd>
<dt><code>ivy-confirm-face</code></dt><dd><p>
Highlights the "(confirm)" part of the prompt.
</p>

<p>
When <code>confirm-nonexistent-file-or-buffer</code> set to <code>t</code>, then
confirming non-existent files in <code>ivy-mode</code> requires an
additional <kbd>RET</kbd>.
</p>

<p>
The confirmation prompt will use this face.
</p>

<p>
For example:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> confirm-nonexistent-file-or-buffer t)
</pre>
</div>

<p>
Then call <code>find-file</code>, enter "eldorado" and press <kbd>RET</kbd> - the
prompt will be appended with "(confirm)". Press <kbd>RET</kbd> once more
to confirm, or any key to continue the completion.
</p></dd>
<dt><code>ivy-match-required-face</code></dt><dd><p>
Highlights the "(match required)" part of the prompt.
</p>

<p>
When completions have to match available candidates and cannot
take random input, the "(match required)" prompt signals this
constraint.
</p>

<p>
For example, call <code>describe-variable</code>, enter "waldo" and press
<kbd>RET</kbd> - "(match required)" is prompted.
Press any key for the prompt to disappear.
</p></dd>
<dt><code>ivy-subdir</code></dt><dd>Highlights directories when completing file names.</dd>
<dt><code>ivy-remote</code></dt><dd>Highlights remote files when completing file names.</dd>
<dt><code>ivy-virtual</code></dt><dd><p>
Highlights virtual buffers when completing buffer names.
</p>

<p>
Virtual buffers correspond to bookmarks and recent files list,
<code>recentf</code>.
</p>

<p>
Enable virtual buffers with:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-use-virtual-buffers t)
</pre>
</div></dd>

<dt><code>ivy-modified-buffer</code></dt><dd>Highlights modified buffers when switching buffer.</dd>
<dt><code>ivy-modified-outside-buffer</code></dt><dd><p>
Highlights buffers modified outside Emacs when switching buffer.
</p>

<p>
This takes precedence over <code>ivy-modified-buffer</code>.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-defcustoms" class="outline-3">
<h3 id="defcustoms"><span class="section-number-3">7.2</span> Defcustoms</h3>
<div class="outline-text-3" id="text-defcustoms">
<dl class="org-dl">
<dt>User Option <code>ivy-count-format</code></dt><dd><p>
A string that specifies display of number of candidates and
current candidate, if one exists.
</p>

<p>
The number of matching candidates by default is shown as a right-
padded integer value.
</p>

<p>
To disable showing the number of candidates:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-count-format <span style="color: #2A00FF;">""</span>)
</pre>
</div>

<p>
To also display the current candidate:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-count-format <span style="color: #2A00FF;">"(%d/%d) "</span>)
</pre>
</div>

<p>
The <code>format</code>-style switches this variable uses are described
in the <code>format</code> documentation.
</p></dd>

<dt>User Option <code>ivy-display-style</code></dt><dd><p>
Specifies highlighting candidates in the minibuffer.
</p>

<p>
The default setting is <code>'fancy</code> in Emacs versions 24.4 or newer.
</p>

<p>
Set <code>ivy-display-style</code> to <code>nil</code> for a plain minibuffer.
</p></dd>

<dt>User Option <code>ivy-on-del-error-function</code></dt><dd><p>
Specifies what to do when <kbd>DEL</kbd> (<code>ivy-backward-delete-char</code>) fails.
</p>

<p>
This is usually the case when there is no text left to delete,
i.e., when <kbd>DEL</kbd> is typed at the beginning of the minibuffer.
</p>

<p>
The default behavior is to quit the completion after <kbd>DEL</kbd> &#x2013; a
handy key to invoke after mistakenly triggering a completion.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-actions" class="outline-3">
<h3 id="actions"><span class="section-number-3">7.3</span> Actions</h3>
<div class="outline-text-3" id="text-actions">
</div>
<div id="outline-container-what-are-actions" class="outline-4">
<h4 id="what-are-actions"><span class="section-number-4">7.3.1</span> What are actions?</h4>
<div class="outline-text-4" id="text-what-are-actions">
<p>
An action is a function that is called after you select a candidate
during completion. This function takes a single string argument, which
is the selected candidate.
</p>

<dl class="org-dl">
<dt>Window context when calling an action</dt><dd><p>
Currently, the action is executed in the minibuffer window
context. This means e.g. that if you call <code>insert</code> the text will
be inserted into the minibuffer.
</p>

<p>
If you want to execute the action in the initial window from
which the completion started, use the <code>with-ivy-window</code> wrapper
macro.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">ivy-insert-action</span> (x)
  (<span style="color: #7F0055; font-weight: bold;">with-ivy-window</span>
    (insert x)))
</pre>
</div></dd>
</dl>
</div>
</div>

<div id="outline-container-how-can-different-actions-be-called" class="outline-4">
<h4 id="how-can-different-actions-be-called"><span class="section-number-4">7.3.2</span> How can different actions be called?</h4>
<div class="outline-text-4" id="text-how-can-different-actions-be-called">
<ul class="org-ul">
<li><kbd>C-m</kbd> (<code>ivy-done</code>) calls the current action.</li>
<li><kbd>M-o</kbd> (<code>ivy-dispatching-done</code>) presents available actions for
selection, calls it after selection, and then exits.</li>
<li><kbd>C-M-o</kbd> (<code>ivy-dispatching-call</code>) presents available actions for
selection, calls it after selection, and then does not exit.</li>
</ul>
</div>
</div>

<div id="outline-container-how-to-modify-the-actions-list" class="outline-4">
<h4 id="how-to-modify-the-actions-list"><span class="section-number-4">7.3.3</span> How to modify the actions list?</h4>
<div class="outline-text-4" id="text-how-to-modify-the-actions-list">
<p>
Currently, you can append any amount of your own actions to the
default list of actions. This can be done either for a specific
command, or for all commands at once.
</p>

<p>
Usually, the command has only one default action. The convention is to
use single letters when selecting a command, and the letter <kbd>o</kbd> is
designated for the default command. This way, <kbd>M-o o</kbd> should be always
equivalent to <kbd>C-m</kbd>.
</p>
</div>
</div>

<div id="outline-container-example---add-two-actions-to-each-command" class="outline-4">
<h4 id="example---add-two-actions-to-each-command"><span class="section-number-4">7.3.4</span> Example - add two actions to each command</h4>
<div class="outline-text-4" id="text-example---add-two-actions-to-each-command">
<p>
The first action inserts the current candidate into the Ivy window -
the window from which <code>ivy-read</code> was called.
</p>

<p>
The second action copies the current candidate to the kill ring.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">ivy-yank-action</span> (x)
  (kill-new x))

(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">ivy-copy-to-buffer-action</span> (x)
  (<span style="color: #7F0055; font-weight: bold;">with-ivy-window</span>
    (insert x)))

(ivy-set-actions
 t
 '((<span style="color: #2A00FF;">"i"</span> ivy-copy-to-buffer-action <span style="color: #2A00FF;">"insert"</span>)
   (<span style="color: #2A00FF;">"y"</span> ivy-yank-action <span style="color: #2A00FF;">"yank"</span>)))
</pre>
</div>

<p>
Then in any completion session, <kbd>M-o y</kbd> invokes <code>ivy-yank-action</code>, and
<kbd>M-o i</kbd> invokes <code>ivy-copy-to-buffer-action</code>.
</p>
</div>

<div id="outline-container-how-to-undo-adding-the-two-actions" class="outline-5">
<h5 id="how-to-undo-adding-the-two-actions"><span class="section-number-5">7.3.4.1</span> How to undo adding the two actions</h5>
<div class="outline-text-5" id="text-how-to-undo-adding-the-two-actions">
<p>
Since <code>ivy-set-actions</code> modifies the internal dictionary with new
data, set the extra actions list to <code>nil</code> by assigning <code>nil</code> value to
the <code>t</code> key as follows:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(ivy-set-actions t nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-how-to-add-actions-to-a-specific-command" class="outline-5">
<h5 id="how-to-add-actions-to-a-specific-command"><span class="section-number-5">7.3.4.2</span> How to add actions to a specific command</h5>
<div class="outline-text-5" id="text-how-to-add-actions-to-a-specific-command">
<p>
Use the command name as the key:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(ivy-set-actions
 'swiper
 '((<span style="color: #2A00FF;">"i"</span> ivy-copy-to-buffer-action <span style="color: #2A00FF;">"insert"</span>)
   (<span style="color: #2A00FF;">"y"</span> ivy-yank-action <span style="color: #2A00FF;">"yank"</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-example---define-a-new-command-with-several-actions" class="outline-4">
<h4 id="example---define-a-new-command-with-several-actions"><span class="section-number-4">7.3.5</span> Example - define a new command with several actions</h4>
<div class="outline-text-4" id="text-example---define-a-new-command-with-several-actions">
<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">my-action-1</span> (x)
  (message <span style="color: #2A00FF;">"action-1: %s"</span> x))

(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">my-action-2</span> (x)
  (message <span style="color: #2A00FF;">"action-2: %s"</span> x))

(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">my-action-3</span> (x)
  (message <span style="color: #2A00FF;">"action-3: %s"</span> x))

(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">my-command-with-3-actions</span> ()
  (<span style="color: #7F0055; font-weight: bold;">interactive</span>)
  (ivy-read <span style="color: #2A00FF;">"test: "</span> '(<span style="color: #2A00FF;">"foo"</span> <span style="color: #2A00FF;">"bar"</span> <span style="color: #2A00FF;">"baz"</span>)
            <span style="color: #7F0055; font-weight: bold;">:action</span> '(1
                      (<span style="color: #2A00FF;">"o"</span> my-action-1 <span style="color: #2A00FF;">"action 1"</span>)
                      (<span style="color: #2A00FF;">"j"</span> my-action-2 <span style="color: #2A00FF;">"action 2"</span>)
                      (<span style="color: #2A00FF;">"k"</span> my-action-3 <span style="color: #2A00FF;">"action 3"</span>))))
</pre>
</div>

<p>
The number 1 above is the index of the default action. Each
action has its own string description for easy selection.
</p>
</div>

<div id="outline-container-test-the-above-function-with-ivy-occur" class="outline-5">
<h5 id="test-the-above-function-with-ivy-occur"><span class="section-number-5">7.3.5.1</span> Test the above function with <code>ivy-occur</code></h5>
<div class="outline-text-5" id="text-test-the-above-function-with-ivy-occur">
<p>
To examine each action with each candidate in a key-efficient way, try:
</p>

<ul class="org-ul">
<li>Call <code>my-command-with-3-actions</code></li>
<li>Press <kbd>C-c C-o</kbd> to close the completion window and move to an
ivy-occur buffer</li>
<li>Press <kbd>kkk</kbd> to move to the first candidate, since the point is most
likely at the end of the buffer</li>
<li>Press <kbd>oo</kbd> to call the first action</li>
<li>Press <kbd>oj</kbd> and <kbd>ok</kbd> to call the second and the third actions</li>
<li>Press <kbd>j</kbd> to move to the next candidate</li>
<li>Press <kbd>oo</kbd>, <kbd>oj</kbd>, <kbd>ok</kbd></li>
<li>Press <kbd>j</kbd> to move to the next candidate</li>
<li>and so on&#x2026;</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-packages" class="outline-3">
<h3 id="packages"><span class="section-number-3">7.4</span> Packages</h3>
<div class="outline-text-3" id="text-packages">
<dl class="org-dl">
<dt><code>org-mode</code></dt><dd><code>org-mode</code> versions 8.3.3 or later obey
<code>completing-read-function</code> (which <code>ivy-mode</code> sets). Try refiling
headings with similar names to appreciate <code>ivy-mode</code>.</dd>
<dt><code>magit</code></dt><dd>Uses ivy by default if Ivy is installed.</dd>
<dt><code>find-file-in-project</code></dt><dd>Uses ivy by default if Ivy is installed.</dd>
<dt><code>projectile</code></dt><dd><p>
Projectile requires this setting for ivy completion:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> projectile-completion-system 'ivy)
</pre>
</div></dd>
<dt><code>helm-make</code></dt><dd><p>
Helm-make requires this setting for ivy completion.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> helm-make-completion-method 'ivy)
</pre>
</div></dd>

<dt>automatically integrated packages</dt><dd>Ivy re-uses the following packages if they are installed:
<code>avy</code>, <code>amx</code> or <code>smex</code>, <code>flx</code>, and <code>wgrep</code>.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-commands" class="outline-2">
<h2 id="commands"><span class="section-number-2">8</span> Commands</h2>
<div class="outline-text-2" id="text-commands">
</div>
<div id="outline-container-file-name-completion" class="outline-3">
<h3 id="file-name-completion"><span class="section-number-3">8.1</span> File Name Completion</h3>
<div class="outline-text-3" id="text-file-name-completion">
<p>
Since file name completion is ubiquitous, Ivy provides extra
bindings that work here:
</p>


<dl class="org-dl">
<dt><kbd>C-j</kbd> (<code>ivy-alt-done</code>)</dt><dd><p>
On a directory, restarts completion from that directory.
</p>

<p>
On a file or <code>./</code>, exit completion with the selected candidate.
</p></dd>
<dt><kbd>DEL</kbd> (<code>ivy-backward-delete-char</code>)</dt><dd>Restart the completion in the parent directory if current input
is empty.</dd>
<dt><kbd>//</kbd> (<code>self-insert-command</code>)</dt><dd>Switch to the root directory.</dd>
<dt><kbd>~</kbd> (<code>self-insert-command</code>)</dt><dd>Switch to the home directory.</dd>
<dt><kbd>/</kbd> (<code>self-insert-command</code>)</dt><dd>If the current input matches an existing directory name exactly,
switch the completion to that directory.</dd>
<dt><kbd>C-M-y</kbd> (<code>ivy-insert-current-full</code>)</dt><dd>Insert the current full path, in case you want to edit a part of it.</dd>
<dt><kbd>M-r</kbd> (<code>ivy-toggle-regexp-quote</code>)</dt><dd><p>
Toggle between input as regexp or not.
</p>

<p>
Switch to matching literally since file names include <code>.</code>, which
is for matching any char in regexp mode.
</p></dd>

<dt>User Option <code>ivy-extra-directories</code></dt><dd><p>
Decide if you want to see <code>../</code> and <code>./</code> during file name
completion.
</p>

<p>
Reason to remove: <code>../</code> is the same as <kbd>DEL</kbd>.
</p>

<p>
Reason not to remove: navigate anywhere with only <kbd>C-n</kbd>, <kbd>C-p</kbd>
and <kbd>C-j</kbd>.
</p>

<p>
Likewise, <code>./</code> can be removed.
</p></dd>

<dt>History</dt><dd>File history works the same with <kbd>M-p</kbd>, <kbd>M-n</kbd>, and <kbd>C-r</kbd>, but
uses a custom code for file name completion that cycles through
files previously opened. It also works with TRAMP files.</dd>
</dl>
</div>

<div id="outline-container-using-tramp" class="outline-4">
<h4 id="using-tramp"><span class="section-number-4">8.1.1</span> Using TRAMP</h4>
<div class="outline-text-4" id="text-using-tramp">
<dl class="org-dl">
<dt><kbd>~</kbd> (tilde)</dt><dd>Move to the home directory. Either the local or the remote one, depending on the
current directory. The boolean option <code>ivy-magic-tilde</code> decides whether the binding to
do this is <kbd>~</kbd> or <kbd>~/</kbd>.</dd>

<dt><kbd>//</kbd> (double slash)</dt><dd>Move to the root directory. Either the local or the remote one, depending on the
current directory. Here, you can also select a TRAMP connection method, such as <code>ssh</code>
or <code>scpx</code>.</dd>

<dt><kbd>/ C-j</kbd></dt><dd>Move the the local root directory.</dd>

<dt><kbd>~~</kbd></dt><dd>Move to the local home directory.</dd>
</dl>


<p>
From any directory, with the empty input, inputting <code>/ssh:</code> and pressing
<kbd>C-j</kbd> (or <kbd>RET</kbd>, which is the same thing) completes for host and user
names.
</p>

<p>
For <code>/ssh:user@</code> input, completes the domain name.
</p>

<p>
<kbd>C-i</kbd> works in a similar way to the default completion.
</p>

<p>
You can also get sudo access for the current directory by inputting
<code>/sudo::</code> <kbd>RET</kbd>. Using <code>/sudo:</code> (i.e. single colon instead of double) will
result in a completion session for the desired user.
</p>

<p>
Multi-hopping is possible, although a bit complex.
</p>

<dl class="org-dl">
<dt>Example : connect to a remote host <code>cloud</code> and open a file with <code>sudo</code> there</dt><dd><ul class="org-ul">
<li><kbd>C-x C-f</kbd> <code>/ssh:cloud|sudo:root:/</code>.</li>
</ul></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-buffer-name-completion" class="outline-3">
<h3 id="buffer-name-completion"><span class="section-number-3">8.2</span> Buffer Name Completion</h3>
<div class="outline-text-3" id="text-buffer-name-completion">
<dl class="org-dl">
<dt>User Option <code>ivy-use-virtual-buffers</code></dt><dd><p>
When non-nil, add <code>recentf-mode</code> and bookmarks to
<code>ivy-switch-buffer</code> completion candidates.
</p>

<p>
Adding this to Emacs init file:
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">setq</span> ivy-use-virtual-buffers t)
</pre>
</div>
<p>
will add additional virtual buffers to the buffers list for recent
files. Selecting such virtual buffers, which are highlighted with
<code>ivy-virtual</code> face, will open the corresponding file.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-counsel-commands" class="outline-3">
<h3 id="counsel-commands"><span class="section-number-3">8.3</span> Counsel commands</h3>
<div class="outline-text-3" id="text-counsel-commands">
<p>
The main advantages of <code>counsel-</code> functions over their basic
equivalents in <code>ivy-mode</code> are:
</p>

<ol class="org-ol">
<li>Multi-actions and non-exiting actions work.</li>
<li><code>ivy-resume</code> can resume the last completion session.</li>
<li>Customize <code>ivy-set-actions</code>, <code>ivy-re-builders-alist</code>.</li>
<li>Customize individual keymaps, such as <code>counsel-describe-map</code>,
<code>counsel-git-grep-map</code>, or <code>counsel-find-file-map</code>, instead of
customizing <code>ivy-minibuffer-map</code> that applies to all completion
sessions.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-api" class="outline-2">
<h2 id="api"><span class="section-number-2">9</span> API</h2>
<div class="outline-text-2" id="text-api">
<p>
The main (and only) entry point is the <code>ivy-read</code> function. It takes
two required arguments and many optional arguments that can be passed
by a key. The optional <code>:action</code> argument is highly recommended for
features such as multi-actions, non-exiting actions, <code>ivy-occur</code> and
<code>ivy-resume</code>.
</p>
</div>

<div id="outline-container-required-arguments-for-ivy-read" class="outline-3">
<h3 id="required-arguments-for-ivy-read"><span class="section-number-3">9.1</span> Required arguments for <code>ivy-read</code></h3>
<div class="outline-text-3" id="text-required-arguments-for-ivy-read">
<dl class="org-dl">
<dt><code>prompt</code></dt><dd>A prompt string normally ending in a colon and a space.
<code>ivy-count-format</code> is prepended to it during completion.</dd>

<dt><code>collection</code></dt><dd><p>
Either a list of strings, a function, an alist or a hash table.
</p>

<p>
If a function, then it has to be compatible with
<code>all-completions</code>.
</p></dd>
</dl>
</div>
</div>

<div id="outline-container-optional-arguments-for-ivy-read" class="outline-3">
<h3 id="optional-arguments-for-ivy-read"><span class="section-number-3">9.2</span> Optional arguments for <code>ivy-read</code></h3>
<div class="outline-text-3" id="text-optional-arguments-for-ivy-read">
<dl class="org-dl">
<dt><code>predicate</code></dt><dd>Is a function to filter the initial collection. It has to be
compatible with <code>all-completions</code>. Tip: most of the time, it's
simpler to just apply this filter to the <code>collection</code> argument
itself, e.g. <code>(cl-remove-if-not predicate collection)</code>.</dd>
<dt><code>require-match</code></dt><dd>When set to a non-nil value, input must match one of the
candidates. Custom input is not accepted.</dd>
<dt><code>initial-input</code></dt><dd><p>
This string argument is included for compatibility with
<code>completing-read</code>, which inserts it into the minibuffer.
</p>

<p>
It's recommended to use the <code>preselect</code> argument instead of this.
</p></dd>
<dt><code>history</code></dt><dd>Name of the symbol to store history. See <code>completing-read</code>.</dd>
<dt><code>preselect</code></dt><dd><p>
Determines which one of the candidates to initially select.
</p>

<p>
When set to an integer value, select the candidate with that
index value.
</p>

<p>
When set to any other non-nil value, select the first candidate
matching this value.  Comparison is first done with <code>equal</code>.
If this fails, and when applicable, match <code>preselect</code> as a
regular expression.
</p>

<p>
Every time the input becomes empty, the item corresponding to
<code>preselect</code> is selected.
</p></dd>
<dt><code>keymap</code></dt><dd>A keymap to be composed with <code>ivy-minibuffer-map</code>. This keymap
has priority over <code>ivy-minibuffer-map</code> and can be modified at any
later stage.</dd>
<dt><code>update-fn</code></dt><dd>Is the function called each time the current candidate changes.
This function takes no arguments and is called in the
minibuffer's <code>post-command-hook</code>. See <code>swiper</code> for an example
usage.</dd>
<dt><code>sort</code></dt><dd>When non-nil, use <code>ivy-sort-functions-alist</code> to sort the
collection as long as the collection is not larger than
<code>ivy-sort-max-size</code>.</dd>
<dt><code>action</code></dt><dd>Is the function to call after selection. It takes a string
argument.</dd>
<dt><code>unwind</code></dt><dd>Is the function to call before exiting completion. It takes no
arguments. This function is called even if the completion is
interrupted with <kbd>C-g</kbd>. See <code>swiper</code> for an example usage.</dd>
<dt><code>re-builder</code></dt><dd>Is a function that takes a string and returns a valid regex. See
<code>Completion Styles</code> for details.</dd>
<dt><code>matcher</code></dt><dd>Is a function that takes a regex string and a list of strings and
returns a list of strings matching the regex. Any ordinary Emacs
matching function will suffice, yet finely tuned matching
functions can be used. See <code>counsel-find-file</code> for an example
usage.</dd>
<dt><code>dynamic-collection</code></dt><dd>When non-nil, <code>collection</code> will be used to dynamically generate
the candidates each time the input changes, instead of being used
once statically with <code>all-completions</code> to generate a list of
strings. See <code>counsel-locate</code> for an example usage.</dd>
<dt><code>caller</code></dt><dd>Is a symbol that uniquely identifies the function that called
<code>ivy-read</code>, which may be useful for further customizations.</dd>
</dl>
</div>
</div>
<div id="outline-container-example---counsel-describe-function" class="outline-3">
<h3 id="example---counsel-describe-function"><span class="section-number-3">9.3</span> Example - <code>counsel-describe-function</code></h3>
<div class="outline-text-3" id="text-example---counsel-describe-function">
<p>
This is a typical example of a function with a non-async collection,
which is a collection where all the strings in the collection are
known prior to any input from the user.
</p>

<p>
Only the first two arguments (along with <code>action</code>) are essential - the
rest of the arguments are for fine-tuning, and could be omitted.
</p>

<p>
The <code>action</code> argument could also be omitted - but then <code>ivy-read</code>
would do nothing except returning the string result, which you could
later use yourself. However, it's recommended that you use the
<code>action</code> argument.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">counsel-describe-function</span> ()
  <span style="color: #2A00FF;">"Forward to `</span><span style="color: #110099;">describe-function</span><span style="color: #2A00FF;">'."</span>
  (<span style="color: #7F0055; font-weight: bold;">interactive</span>)
  (ivy-read <span style="color: #2A00FF;">"Describe function: "</span>
            (<span style="color: #7F0055; font-weight: bold;">let</span> (cands)
              (mapatoms
               (<span style="color: #7F0055; font-weight: bold;">lambda</span> (x)
                 (<span style="color: #7F0055; font-weight: bold;">when</span> (fboundp x)
                   (<span style="color: #7F0055; font-weight: bold;">push</span> (symbol-name x) cands))))
              cands)
            <span style="color: #7F0055; font-weight: bold;">:keymap</span> counsel-describe-map
            <span style="color: #7F0055; font-weight: bold;">:preselect</span> (ivy-thing-at-point)
            <span style="color: #7F0055; font-weight: bold;">:history</span> 'counsel-describe-symbol-history
            <span style="color: #7F0055; font-weight: bold;">:require-match</span> t
            <span style="color: #7F0055; font-weight: bold;">:action</span> (<span style="color: #7F0055; font-weight: bold;">lambda</span> (x)
                      (describe-function
                       (intern x)))
            <span style="color: #7F0055; font-weight: bold;">:caller</span> 'counsel-describe-function))
</pre>
</div>

<p>
Here are the interesting features of the above function, in the order that they appear:
</p>

<ul class="org-ul">
<li>The <code>prompt</code> argument is a simple string ending in ": ".</li>
<li>The <code>collection</code> argument evaluates to a (large) list of strings.</li>
<li>The <code>keymap</code> argument is for a custom keymap to supplement <code>ivy-minibuffer-map</code>.</li>
<li>The <code>preselect</code> is provided by <code>ivy-thing-at-point</code>, which
returns a symbol near the point. Ivy then selects the first
candidate from the collection that matches this symbol. To select
this pre-selected candidate, a <kbd>RET</kbd> will suffice. No further user
input is necessary.</li>
<li>The <code>history</code> argument is for keeping the history of this command
separate from the common history in <code>ivy-history</code>.</li>
<li>The <code>require-match</code> is set to <code>t</code> since it doesn't make sense to
call <code>describe-function</code> on an un-interned symbol.</li>
<li>The <code>action</code> argument calls <code>describe-function</code> on the interned
selected candidate.</li>
<li>The <code>caller</code> argument identifies this completion session. This is
important, since with the collection being a list of strings and not
a function name, the only other way for <code>ivy-read</code> to identify
"who's calling" and to apply the appropriate customizations is to
examine <code>this-command</code>. But <code>this-command</code> would be modified if
another command called <code>counsel-describe-function</code>.</li>
</ul>
</div>
</div>
<div id="outline-container-example---counsel-locate" class="outline-3">
<h3 id="example---counsel-locate"><span class="section-number-3">9.4</span> Example - <code>counsel-locate</code></h3>
<div class="outline-text-3" id="text-example---counsel-locate">
<p>
This is a typical example of a function with an async collection.
Since the collection function cannot pre-compute all the locatable
files in memory within reasonable limits (time or memory), it relies
on user input to filter the universe of possible candidates to a
manageable size while also continuing to search asynchronously for
possible candidates. Both the filtering and searching continues with
each character change of the input with rapid updates to the
collection presented without idle waiting times. This live update will
continue as long as there are likely candidates. Eventually updates to
the minibuffer will stop after user input, filtering, and searching
have exhausted looking for possible candidates.
</p>

<p>
Async collections suit long-running shell commands, such as <code>locate</code>.
With each new input, a new process starts while the old process is
killed. The collection is refreshed anew with each new process.
Meanwhile the user can provide more input characters (for further
narrowing) or select a candidate from the visible collection.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">counsel-locate-function</span> (str)
  (<span style="color: #7F0055; font-weight: bold;">or</span>
   (ivy-more-chars)
   (<span style="color: #7F0055; font-weight: bold;">progn</span>
     (counsel--async-command
      (format <span style="color: #2A00FF;">"locate %s '%s'"</span>
              (mapconcat #'identity counsel-locate-options <span style="color: #2A00FF;">" "</span>)
              (counsel--elisp-to-pcre
               (ivy--regex str))))
     '(<span style="color: #2A00FF;">""</span> <span style="color: #2A00FF;">"working..."</span>))))

<span style="color: #3F7F5F;">;;;</span><span style="color: #3F7F5F;">###</span><span style="color: #FF0000;">autoload</span>
(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">counsel-locate</span> (<span style="color: #000000; font-style: italic; text-decoration: underline;">&amp;optional</span> initial-input)
  <span style="color: #2A00FF;">"Call the \"locate\" shell command.</span>
<span style="color: #2A00FF;">INITIAL-INPUT can be given as the initial minibuffer input."</span>
  (<span style="color: #7F0055; font-weight: bold;">interactive</span>)
  (ivy-read <span style="color: #2A00FF;">"Locate: "</span> #'counsel-locate-function
            <span style="color: #7F0055; font-weight: bold;">:initial-input</span> initial-input
            <span style="color: #7F0055; font-weight: bold;">:dynamic-collection</span> t
            <span style="color: #7F0055; font-weight: bold;">:history</span> 'counsel-locate-history
            <span style="color: #7F0055; font-weight: bold;">:action</span> (<span style="color: #7F0055; font-weight: bold;">lambda</span> (file)
                      (<span style="color: #7F0055; font-weight: bold;">with-ivy-window</span>
                        (<span style="color: #7F0055; font-weight: bold;">when</span> file
                          (find-file file))))
            <span style="color: #7F0055; font-weight: bold;">:unwind</span> #'counsel-delete-process
            <span style="color: #7F0055; font-weight: bold;">:caller</span> 'counsel-locate))
</pre>
</div>

<p>
Here are the interesting features of the above functions, in the order
that they appear:
</p>

<ul class="org-ul">
<li><code>counsel-locate-function</code> takes a string argument and returns a list
of strings. Note that it's not compatible with <code>all-completions</code>,
but since we're not using that here, might as well use one argument
instead of three.</li>
<li><code>ivy-more-chars</code> is a simple function that returns e.g.
<code>'("2 chars more")</code> asking the user for more input.</li>
<li><code>counsel--async-command</code> is a very easy API simplification that
takes a single string argument suitable for
<code>shell-command-to-string</code>. So you could prototype your function as
non-async using <code>shell-command-to-string</code> and <code>split-string</code> to
produce a collection, then decide that you want async and simply swap in
<code>counsel--async-command</code>.</li>
<li><code>counsel-locate</code> is an interactive function with an optional <code>initial-input</code>.</li>
<li><code>#'counsel-locate-function</code> is passed as the <code>collection</code> argument.</li>
<li><code>dynamic-collection</code> is set to t, since this is an async collection.</li>
<li><code>action</code> argument uses <code>with-ivy-window</code> wrapper, since we want to open the
selected file in the same window from which <code>counsel-locate</code> was
called.</li>
<li><code>unwind</code> argument is set to <code>#'counsel-delete-process</code>: when we press <kbd>C-g</kbd>
we want to kill the running process created by
<code>counsel--async-command</code>.</li>
<li><code>caller</code> argument identifies this command for easier customization.</li>
</ul>
</div>
</div>
<div id="outline-container-example---ivy-read-with-extra-properties" class="outline-3">
<h3 id="example---ivy-read-with-extra-properties"><span class="section-number-3">9.5</span> Example - <code>ivy-read-with-extra-properties</code></h3>
<div class="outline-text-3" id="text-example---ivy-read-with-extra-properties">
<p>
This is another example to show how to associate additional values to each
displayed strings.
</p>

<div class="org-src-container">
<pre class="src src-elisp">(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">find-candidates-function</span> (str pred _)
  (<span style="color: #7F0055; font-weight: bold;">let</span> ((props '(1 2))
        (strs '(<span style="color: #2A00FF;">"foo"</span> <span style="color: #2A00FF;">"foo2"</span>)))
    (cl-mapcar (<span style="color: #7F0055; font-weight: bold;">lambda</span> (s p) (propertize s 'property p))
               strs
               props)))

(<span style="color: #7F0055; font-weight: bold;">defun</span> <span style="color: #000000; font-weight: bold;">find-candidates</span> ()
  (<span style="color: #7F0055; font-weight: bold;">interactive</span>)
  (ivy-read <span style="color: #2A00FF;">"Find symbols: "</span>
            #'find-candidates-function
            <span style="color: #7F0055; font-weight: bold;">:action</span> (<span style="color: #7F0055; font-weight: bold;">lambda</span> (x)
                      (message <span style="color: #2A00FF;">"Value: %s"</span> (get-text-property 0 'property x)
                       ))))
</pre>
</div>

<p>
Here are the interesting features of the above function:
</p>

<ul class="org-ul">
<li><code>find-candidates-function</code> builds up a list of strings and associates "foo" with
the value 1 and "foo2" with 2.</li>
<li><code>find-candidates</code> is an interactive function.</li>
<li><code>#'find-candidates</code> is passed as the <code>collection</code> argument.</li>
<li><code>action</code> gets passed the selected string with the associated value. It
then retrieves that value and displays it.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-variable-index" class="outline-2">
<h2 id="variable-index"><span class="section-number-2">10</span> Variable Index</h2>
<div class="outline-text-2" id="text-variable-index">
</div>
</div>

<div id="outline-container-key-index" class="outline-2">
<h2 id="key-index"><span class="section-number-2">11</span> Keystroke Index</h2>
<div class="outline-text-2" id="text-key-index">
</div>
</div>
</div>
</body>
</html>
